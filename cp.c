#include <stdio.h> 
#include <stdlib.h> 
#include <fcntl.h> 
#include <unistd.h> 

#define BUFFER_SIZE 1024 // Define a macro for the buffer size.

// Function to copy the content of one file to another.
void copy_file(const char *src, const char *dest) {
    int src_fd, dest_fd, n_read; // File descriptors and read count declaration.
    char buffer[BUFFER_SIZE];    // Buffer to hold file content temporarily.

    // Open the source file for reading only.
    src_fd = open(src, O_RDONLY);
    if(src_fd < 0) exit(1); // Exit if opening the file fails.

    // Open the destination file for writing, create if it doesn't exist, with rw-rw-rw- permissions.
    dest_fd = open(dest, O_WRONLY | O_CREAT, 0666);
    if(dest_fd < 0) exit(1); // Exit if opening/creating the file fails.

    // Read from the source file and write to the destination file in a loop.
    while((n_read = read(src_fd, buffer, BUFFER_SIZE)) > 0) {
        write(dest_fd, buffer, n_read); // Write the amount of data read to the destination file.
    }

    // Close the source and destination file descriptors.
    close(src_fd);
    close(dest_fd);
}

// The main function where the program starts executing.
int main(int argc, char *argv[]) {
    // Check if the number of arguments is exactly 3 (program name, source file, destination file).
    if(argc != 3) {
        // Print usage message to the standard error.
        fprintf(stderr, "Usage: %s source_file destination_file\n", argv[0]);
        exit(EXIT_FAILURE); // Exit with failure if arguments are not correct.
    }

    // Call the function to copy the file with arguments provided.
    copy_file(argv[1], argv[2]);

    // Return with success.
    return EXIT_SUCCESS;
}
